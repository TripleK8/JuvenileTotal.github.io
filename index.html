<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/th.js"></script> 

    <script>
        tailwind.config = {
            theme: {
                fontFamily: {
                    sans: ['Sarabun', 'sans-serif'],
                },
                extend: {
                    colors: {
                        primary: '#4F46E5',
                        secondary: '#10B981',
                        accent: '#F59E0B',
                    },
                    boxShadow: {
                        'soft': '0 4px 20px -2px rgba(0, 0, 0, 0.05)',
                        'card': '0 0 0 1px rgba(0,0,0,0.03), 0 2px 8px rgba(0,0,0,0.04)',
                    }
                }
            }
        }
    </script>
    <style>
        .animate-fade-in-up {
            animation: fadeInUp 0.6s ease-out forwards;
            opacity: 0;
            transform: translateY(20px);
        }
        @keyframes fadeInUp {
            to { opacity: 1; transform: translateY(0); }
        }
        .delay-100 { animation-delay: 0.1s; }
        .delay-200 { animation-delay: 0.2s; }
        .delay-300 { animation-delay: 0.3s; }

        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
        
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô Flatpickr */
        .flatpickr-calendar {
            font-family: 'Sarabun', sans-serif !important;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            border-radius: 0.75rem;
        }
        .flatpickr-day.selected, .flatpickr-day.startRange, .flatpickr-day.endRange, .flatpickr-day.selected.inRange, .flatpickr-day.startRange.inRange, .flatpickr-day.endRange.inRange {
            background: #4F46E5 !important;
            border-color: #4F46E5 !important;
            color: white !important;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen font-sans text-slate-600">

    <nav class="bg-white border-b border-gray-100">
        <div class="container mx-auto max-w-7xl px-6 py-4 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="p-2 bg-indigo-50 rounded-lg text-indigo-600">
                    <i data-lucide="layout-dashboard"></i>
                </div>
                <div>
                    <h1 id="navTitle" class="text-xl font-bold text-slate-800 leading-tight">Dashboard ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á</h1>
                    <p id="navSubtitle" class="text-xs text-slate-500">‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏à‡∏±‡∏¢‡πÅ‡∏•‡∏∞‡∏•‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà</p>
                </div>
            </div>
            <div class="flex gap-3">
                <button onclick="toggleLanguage()" class="flex items-center gap-2 text-sm font-semibold text-slate-600 hover:text-indigo-600 bg-white border border-slate-200 hover:border-indigo-200 px-3 py-2 rounded-lg transition-all">
                    <span class="flex items-center justify-center w-5 h-5 rounded-full bg-slate-100 text-[10px]" id="langIcon">TH</span>
                    <span id="langText">English</span>
                </button>
                <button onclick="window.print()" class="hidden md:flex items-center gap-2 text-sm font-medium text-slate-500 hover:text-indigo-600 transition-colors bg-gray-50 hover:bg-indigo-50 px-4 py-2 rounded-lg border border-transparent hover:border-indigo-100 cursor-pointer">
                    <i data-lucide="printer" size="16"></i> <span id="btnPrint">‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</span>
                </button>
            </div>
        </div>
    </nav>

    <main class="container mx-auto max-w-7xl px-6 py-8 space-y-8">
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 animate-fade-in-up">
            <div class="bg-white p-6 rounded-2xl shadow-card hover:shadow-lg transition-shadow duration-300 relative overflow-hidden group">
                <div class="absolute right-0 top-0 h-full w-1/3 bg-gradient-to-l from-blue-50 to-transparent opacity-50 group-hover:from-blue-100 transition-all"></div>
                <div class="relative z-10">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="p-2.5 rounded-xl bg-blue-100 text-blue-600 shadow-sm">
                            <i data-lucide="users" size="20"></i>
                        </div>
                        <h3 id="card1Title" class="text-sm font-semibold text-slate-500 uppercase tracking-wide">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
                    </div>
                    <div class="flex items-baseline gap-2">
                        <span id="totalSamples" class="text-4xl font-bold text-slate-800 tracking-tight">0</span>
                        <span id="unitPerson" class="text-sm font-medium text-slate-400">‡∏Ñ‡∏ô</span>
                    </div>
                </div>
            </div>

            <div class="bg-white p-6 rounded-2xl shadow-card hover:shadow-lg transition-shadow duration-300 relative overflow-hidden group">
                <div class="absolute right-0 top-0 h-full w-1/3 bg-gradient-to-l from-indigo-50 to-transparent opacity-50 group-hover:from-indigo-100 transition-all"></div>
                <div class="relative z-10">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="p-2.5 rounded-xl bg-indigo-100 text-indigo-600 shadow-sm">
                            <i data-lucide="user" size="20"></i>
                        </div>
                        <h3 id="card2Title" class="text-sm font-semibold text-slate-500 uppercase tracking-wide">‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏û‡∏®‡∏ä‡∏≤‡∏¢</h3>
                    </div>
                    <div class="flex items-baseline gap-2">
                        <span id="maleCount" class="text-4xl font-bold text-slate-800 tracking-tight">0</span>
                        <span id="unitPerson2" class="text-sm font-medium text-slate-400">‡∏Ñ‡∏ô</span>
                    </div>
                </div>
            </div>

            <div class="bg-white p-6 rounded-2xl shadow-card hover:shadow-lg transition-shadow duration-300 relative overflow-hidden group">
                <div class="absolute right-0 top-0 h-full w-1/3 bg-gradient-to-l from-emerald-50 to-transparent opacity-50 group-hover:from-emerald-100 transition-all"></div>
                <div class="relative z-10">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="p-2.5 rounded-xl bg-emerald-100 text-emerald-600 shadow-sm">
                            <i data-lucide="map-pin" size="20"></i>
                        </div>
                        <h3 id="card3Title" class="text-sm font-semibold text-slate-500 uppercase tracking-wide">‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ù‡∏∂‡∏Å‡∏Ø ‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</h3>
                    </div>
                    <div class="flex items-baseline gap-2">
                        <span id="centerCount" class="text-4xl font-bold text-slate-800 tracking-tight">0</span>
                        <span id="unitCenter" class="text-sm font-medium text-slate-400">‡πÅ‡∏´‡πà‡∏á</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="bg-white p-6 rounded-2xl shadow-soft border border-gray-100 animate-fade-in-up delay-100">
                <div class="mb-6">
                    <h2 id="chart1Title" class="text-xl font-bold text-slate-800 flex items-center gap-2">
                        <i data-lucide="pie-chart" class="text-indigo-500"></i>
                        ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏ï‡∏±‡∏ß‡∏Ç‡∏≠‡∏á‡πÄ‡∏û‡∏®
                    </h2>
                    <p class="text-sm text-slate-500 mt-1">‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏û‡∏®‡∏ä‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏®‡∏´‡∏ç‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                </div>
                <div class="chart-container flex justify-center items-center">
                    <canvas id="genderChart"></canvas>
                </div>
            </div>

            <div class="bg-white p-6 rounded-2xl shadow-soft border border-gray-100 animate-fade-in-up delay-200">
                <div class="mb-6">
                    <h2 id="chart2Title" class="text-xl font-bold text-slate-800 flex items-center gap-2">
                        <i data-lucide="bar-chart-2" class="text-indigo-500"></i>
                        ‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏≤‡∏°‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ù‡∏∂‡∏Å‡∏Ø
                    </h2>
                    <p class="text-sm text-slate-500 mt-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ù‡∏∂‡∏Å‡∏Ø</p>
                </div>
                <div class="chart-container">
                    <canvas id="centerPieChart"></canvas>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-2xl shadow-soft border border-gray-100 overflow-hidden animate-fade-in-up delay-300">
            <div class="p-6 border-b border-gray-100 flex flex-col md:flex-row md:items-center justify-between gap-4">
                <div>
                    <h2 class="text-xl font-bold text-slate-800 flex items-center gap-2">
                        <i data-lucide="calendar-days" class="text-indigo-500"></i>
                        <span id="tableTitle">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà</span>
                    </h2>
                    <p id="tableSubtitle" class="text-sm text-slate-500 mt-1">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</p>
                </div>
                
                <div class="flex gap-2 items-center">
                    <div class="relative">
                        <input type="text" id="dateRangePicker" placeholder="‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà" class="pl-10 pr-4 py-2 text-sm border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 w-full md:w-60 cursor-pointer">
                        <i data-lucide="calendar" size="16" class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                    </div>
                    <button onclick="resetFilter()" class="px-3 py-2 bg-gray-100 text-gray-700 rounded-lg text-sm font-semibold hover:bg-gray-200 transition-colors" title="‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà">
                        <i data-lucide="rotate-ccw" size="16"></i>
                    </button>
                    <span class="px-3 py-1 bg-indigo-50 text-indigo-700 rounded-lg text-xs font-semibold uppercase tracking-wider hidden md:block">Year 2025-2026</span>
                </div>
            </div>
            
            <div class="overflow-x-auto">
                <table class="w-full text-sm text-left">
                    <thead class="bg-gray-50 text-slate-500 font-semibold text-xs uppercase tracking-wider">
                        <tr>
                            <th class="px-6 py-4 rounded-tl-lg">#</th>
                            <th id="thCenter" class="px-6 py-4">‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ù‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏≠‡∏ö‡∏£‡∏°‡∏Ø</th>
                            <th id="thDate" class="px-6 py-4">‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</th>
                            <th id="thMale" class="px-6 py-4 text-center">‡∏ä‡∏≤‡∏¢</th>
                            <th id="thFemale" class="px-6 py-4 text-center">‡∏´‡∏ç‡∏¥‡∏á</th>
                            <th id="thTotal" class="px-6 py-4 text-right rounded-tr-lg">‡∏£‡∏ß‡∏° (‡∏Ñ‡∏ô)</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody" class="divide-y divide-gray-100">
                        </tbody>
                    <tfoot class="bg-gray-50/50 font-bold text-slate-800">
                        <tr>
                            <td id="footerTotal" colspan="3" class="px-6 py-5 text-right text-slate-500">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</td>
                            <td id="totalMaleTable" class="px-6 py-5 text-center text-indigo-600">0</td>
                            <td id="totalFemaleTable" class="px-6 py-5 text-center text-pink-600">0</td>
                            <td id="totalSampleTable" class="px-6 py-5 text-right text-lg">0</td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>

    </main>

    <script>
        // Language State
        let currentLang = 'th';

        // Translation Data
        const i18n = {
            th: {
                navTitle: "Dashboard ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á",
                navSubtitle: "‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏à‡∏±‡∏¢‡πÅ‡∏•‡∏∞‡∏•‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà",
                langText: "English",
                btnPrint: "‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô",
                card1Title: "‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î",
                unitPerson: "‡∏Ñ‡∏ô",
                unitPerson2: "‡∏Ñ‡∏ô",
                unitCenter: "‡πÅ‡∏´‡πà‡∏á",
                card2Title: "‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏û‡∏®‡∏ä‡∏≤‡∏¢",
                card3Title: "‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ù‡∏∂‡∏Å‡∏Ø ‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°",
                chart1Title: "‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏ï‡∏±‡∏ß‡∏Ç‡∏≠‡∏á‡πÄ‡∏û‡∏®",
                chart2Title: "‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏≤‡∏°‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ù‡∏∂‡∏Å‡∏Ø",
                tableTitle: "‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà",
                tableSubtitle: "‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£",
                thCenter: "‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ù‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏≠‡∏ö‡∏£‡∏°‡∏Ø",
                thDate: "‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£",
                thMale: "‡∏ä‡∏≤‡∏¢",
                thFemale: "‡∏´‡∏ç‡∏¥‡∏á",
                thTotal: "‡∏£‡∏ß‡∏° (‡∏Ñ‡∏ô)",
                footerTotal: "‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î",
                male: "‡∏ä‡∏≤‡∏¢",
                female: "‡∏´‡∏ç‡∏¥‡∏á"
            },
            en: {
                navTitle: "Sampling Dashboard",
                navSubtitle: "Research Status & Field Visit Tracking",
                langText: "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢",
                btnPrint: "Print Report",
                card1Title: "Total Samples",
                unitPerson: "Persons",
                unitPerson2: "Persons",
                unitCenter: "Centers",
                card2Title: "Male Ratio",
                card3Title: "Participating Centers",
                chart1Title: "Gender Distribution",
                chart2Title: "Proportion by Center",
                tableTitle: "Field Visit Schedule",
                tableSubtitle: "Sample size details and operation periods",
                thCenter: "Training Center",
                thDate: "Operation Period",
                thMale: "Male",
                thFemale: "Female",
                thTotal: "Total",
                footerTotal: "Grand Total",
                male: "Male",
                female: "Female"
            }
        };

        // Center Name Mappings (Key to English)
        const centerTranslations = {
            "‡∏£‡∏∞‡∏¢‡∏≠‡∏á": "Rayong",
            "‡∏£‡∏≤‡∏ä‡∏ö‡∏∏‡∏£‡∏µ": "Ratchaburi",
            "‡∏ö‡πâ‡∏≤‡∏ô‡∏ä‡∏≤‡∏¢‡∏Å‡∏£‡∏∏‡∏ì‡∏≤": "Ban Chai Karuna",
            "‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà": "Chiang Mai",
            "‡∏™‡∏∏‡∏£‡∏≤‡∏©‡∏é‡∏£‡πå‡∏ò‡∏≤‡∏ô‡∏µ": "Surat Thani",
            "‡∏≠‡∏∏‡∏ö‡∏•‡∏£‡∏≤‡∏ä‡∏ò‡∏≤‡∏ô‡∏µ": "Ubon Ratchathani"
        };

        // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏±‡∏Å (Stats) - ‡πÉ‡∏ä‡πâ Keys ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ Map
        const data1 = [
            { center: "‡∏£‡∏∞‡∏¢‡∏≠‡∏á", sample: 18, male: 14, female: 4 },
            { center: "‡∏ö‡πâ‡∏≤‡∏ô‡∏ä‡∏≤‡∏¢‡∏Å‡∏£‡∏∏‡∏ì‡∏≤", sample: 47, male: 47, female: 0 },
            { center: "‡∏£‡∏≤‡∏ä‡∏ö‡∏∏‡∏£‡∏µ", sample: 41, male: 40, female: 1 },
            { center: "‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà", sample: 60, male: 56, female: 4 },
            { center: "‡∏™‡∏∏‡∏£‡∏≤‡∏©‡∏é‡∏£‡πå‡∏ò‡∏≤‡∏ô‡∏µ", sample: 66, male: 60, female: 6 },
            { center: "‡∏≠‡∏∏‡∏ö‡∏•‡∏£‡∏≤‡∏ä‡∏ò‡∏≤‡∏ô‡∏µ", sample: 140, male: 131, female: 9 },
        ];

        // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î + ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©)
        const data2 = [
            { name: "‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ù‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏≠‡∏ö‡∏£‡∏°‡πÄ‡∏î‡πá‡∏Å‡πÅ‡∏•‡∏∞‡πÄ‡∏¢‡∏≤‡∏ß‡∏ä‡∏ô‡∏£‡∏∞‡∏¢‡∏≠‡∏á", nameEn: "Juvenile Training Center Rayong", province: "‡∏£‡∏∞‡∏¢‡∏≠‡∏á", provinceEn: "Rayong", date: "17 ‚Äì 22 ‡∏û.‡∏¢. 68", dateEn: "17 ‚Äì 22 Nov 25" },
            { name: "‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ù‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏≠‡∏ö‡∏£‡∏°‡πÄ‡∏î‡πá‡∏Å‡πÅ‡∏•‡∏∞‡πÄ‡∏¢‡∏≤‡∏ß‡∏ä‡∏ô‡∏£‡∏≤‡∏ä‡∏ö‡∏∏‡∏£‡∏µ", nameEn: "Juvenile Training Center Ratchaburi", province: "‡∏£‡∏≤‡∏ä‡∏ö‡∏∏‡∏£‡∏µ", provinceEn: "Ratchaburi", date: "15 ‚Äì 20 ‡∏ò.‡∏Ñ. 68", dateEn: "15 ‚Äì 20 Dec 25" },
            { name: "‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ù‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏≠‡∏ö‡∏£‡∏°‡πÄ‡∏î‡πá‡∏Å‡πÅ‡∏•‡∏∞‡πÄ‡∏¢‡∏≤‡∏ß‡∏ä‡∏ô‡∏ö‡πâ‡∏≤‡∏ô‡∏ä‡∏≤‡∏¢‡∏Å‡∏£‡∏∏‡∏ì‡∏≤", nameEn: "Ban Chai Karuna Training Center", province: "‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏õ‡∏£‡∏≤‡∏Å‡∏≤‡∏£", provinceEn: "Samut Prakan", date: "8 ‚Äì 13 ‡∏ò.‡∏Ñ. 68", dateEn: "8 ‚Äì 13 Dec 25" },
            { name: "‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ù‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏≠‡∏ö‡∏£‡∏°‡πÄ‡∏î‡πá‡∏Å‡πÅ‡∏•‡∏∞‡πÄ‡∏¢‡∏≤‡∏ß‡∏ä‡∏ô‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà", nameEn: "Juvenile Training Center Chiang Mai", province: "‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà", provinceEn: "Chiang Mai", date: "5 ‚Äì 10 ‡∏°.‡∏Ñ. 69", dateEn: "5 ‚Äì 10 Jan 26" },
            { name: "‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ù‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏≠‡∏ö‡∏£‡∏°‡πÄ‡∏î‡πá‡∏Å‡πÅ‡∏•‡∏∞‡πÄ‡∏¢‡∏≤‡∏ß‡∏ä‡∏ô‡∏™‡∏∏‡∏£‡∏≤‡∏©‡∏é‡∏£‡πå‡∏ò‡∏≤‡∏ô‡∏µ", nameEn: "Juvenile Training Center Surat Thani", province: "‡∏™‡∏∏‡∏£‡∏≤‡∏©‡∏é‡∏£‡πå‡∏ò‡∏≤‡∏ô‡∏µ", provinceEn: "Surat Thani", date: "19 ‚Äì 24 ‡∏°.‡∏Ñ. 69", dateEn: "19 ‚Äì 24 Jan 26" },
            { name: "‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ù‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏≠‡∏ö‡∏£‡∏°‡πÄ‡∏î‡πá‡∏Å‡πÅ‡∏•‡∏∞‡πÄ‡∏¢‡∏≤‡∏ß‡∏ä‡∏ô‡∏≠‡∏∏‡∏ö‡∏•‡∏£‡∏≤‡∏ä‡∏ò‡∏≤‡∏ô‡∏µ", nameEn: "Juvenile Training Center Ubon Ratchathani", province: "‡∏≠‡∏∏‡∏ö‡∏•‡∏£‡∏≤‡∏ä‡∏ò‡∏≤‡∏ô‡∏µ", provinceEn: "Ubon Ratchathani", date: "2 ‚Äì 7, 9 ‚Äì 14 ‡∏Å.‡∏û. 69", dateEn: "2 ‚Äì 7, 9 ‚Äì 14 Feb 26" },
        ];

        // üîë ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á (‡∏ñ‡∏π‡∏Å‡∏Å‡∏£‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß)
        let filteredData1 = data1;
        let globalTotalStats = {}; // ‡πÄ‡∏Å‡πá‡∏ö Total Stats

        // Chart Instances
        let genderChartInstance = null;
        let pieChartInstance = null;
        
        // --- Helper Functions ---

        /**
         * ‡πÅ‡∏õ‡∏•‡∏á‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏ó‡∏¢ (DD ‚Äì DD MMM YY) ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô Date Object
         * @param {string} dateRangeStr - ‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ (e.g., "17 ‚Äì 22 ‡∏û.‡∏¢. 68")
         * @returns {object|null} { startDate: Date, endDate: Date }
         */
        function parseThaiDateRange(dateRangeStr) {
            if (!dateRangeStr) {
                return null;
            }

            // ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏°‡∏µ‡∏´‡∏•‡∏≤‡∏¢‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ ‡πÄ‡∏ä‡πà‡∏ô "2 ‚Äì 7, 9 ‚Äì 14 ‡∏Å.‡∏û. 69" 
            // ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏ä‡πà‡∏ß‡∏á‡πÅ‡∏£‡∏Å‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á
            const firstRange = dateRangeStr.split(',')[0].trim();
            
            // ‡πÉ‡∏ä‡πâ regex ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà, ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô, ‡πÅ‡∏•‡∏∞ ‡∏õ‡∏µ
            const dateRegex = /(\d+)\s*(‚Äì|-)?\s*(\d+)?\s*([‡∏Å-‡∏Æ]+\.)\s*(\d+)/;
            const match = firstRange.match(dateRegex);

            if (!match) {
                 // Handle complex cases like "2 ‚Äì 7, 9 ‚Äì 14 ‡∏Å.‡∏û. 69"
                const complexMatch = firstRange.match(/(\d+)\s*(‚Äì)\s*(\d+)\s*([‡∏Å-‡∏Æ]+\.)\s*(\d+)/);
                if (!complexMatch) return null;
            }

            const [_, day1, dash, day2, monthStr, yearStr] = match;

            const monthMap = {
                '‡∏°.‡∏Ñ.': 0, '‡∏Å.‡∏û.': 1, '‡∏°‡∏µ.‡∏Ñ.': 2, '‡πÄ‡∏°.‡∏¢.': 3,
                '‡∏û.‡∏Ñ.': 4, '‡∏°‡∏¥.‡∏¢.': 5, '‡∏Å.‡∏Ñ.': 6, '‡∏™.‡∏Ñ.': 7,
                '‡∏Å.‡∏¢.': 8, '‡∏ï.‡∏Ñ.': 9, '‡∏û.‡∏¢.': 10, '‡∏ò.‡∏Ñ.': 11
            };
            
            const month = monthMap[monthStr];
            let year = parseInt(yearStr, 10);
            
            // ‡πÅ‡∏õ‡∏•‡∏á‡∏õ‡∏µ ‡∏û.‡∏®. ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô ‡∏Ñ.‡∏®.
            if (year > 50 && year < 100) {
                year += 2000;
            } else if (year < 50) {
                 year += 2000; // ‡∏™‡∏°‡∏°‡∏ï‡∏¥‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏µ 20xx
            }
            
            let startDay = parseInt(day1, 10);
            let endDay = parseInt(day2 || day1, 10);

            // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô (‡πÄ‡∏ä‡πà‡∏ô 17 ‡∏û.‡∏¢. 68) day2 ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô undefined/null
            if (!day2) {
                endDay = startDay;
            }
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏õ‡∏µ‡πÄ‡∏õ‡πá‡∏ô ‡∏û.‡∏®. ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà ‡πÅ‡∏•‡∏∞‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô ‡∏Ñ.‡∏®.
            // ‡πÉ‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏ä‡πâ '68'/'69' ‡∏ã‡∏∂‡πà‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á ‡∏û.‡∏®.
            if (year < 2500) {
                 year += 543; // ‡πÅ‡∏õ‡∏•‡∏á ‡∏û.‡∏®. ‡πÄ‡∏õ‡πá‡∏ô ‡∏Ñ.‡∏®.
            }

            const startDate = new Date(year, month, startDay);
            const endDate = new Date(year, month, endDay, 23, 59, 59); // ‡πÉ‡∏´‡πâ‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏ß‡∏±‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢

            return { startDate, endDate };
        }
        
        /**
         * üîë ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Flatpickr
         */
        function setupFlatpickr() {
            flatpickr("#dateRangePicker", {
                mode: "range",
                dateFormat: "Y-m-d", // ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà Flatpickr ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏†‡∏≤‡∏¢‡πÉ‡∏ô
                locale: "th", // ‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
                minDate: "2025-11-17",
                maxDate: "2026-02-14",
                onChange: function(selectedDates, dateStr, instance) {
                    if (selectedDates.length === 2) {
                        applyFilter(selectedDates[0], selectedDates[1]);
                    } else if (selectedDates.length === 0 && dateStr === "") {
                        resetFilter(); // ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏î‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô
                    }
                }
            });
        }

        /**
         * üîë ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡∏ß‡∏°‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß
         */
        function calculateTotalStats(data) {
            return data.reduce((acc, curr) => ({
                sample: acc.sample + curr.sample,
                male: acc.male + curr.male,
                female: acc.female + curr.female
            }), { sample: 0, male: 0, female: 0 });
        }

        /**
         * üîë ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
         */
        function applyFilter(startFilterDate, endFilterDate) {
            if (!startFilterDate || !endFilterDate) {
                return resetFilter();
            }

            // 1. ‡∏´‡∏≤‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ù‡∏∂‡∏Å‡∏Ø ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏Å‡∏±‡∏ö‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
            const filteredCentersDetails = data2.filter(detail => {
                const dateRange = parseThaiDateRange(detail.date);
                if (!dateRange) return false;

                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô (Overlap Check): 
                // ‡∏ä‡πà‡∏ß‡∏á A ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡πà‡∏≠‡∏ô B ‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î ‡πÅ‡∏•‡∏∞ B ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡πà‡∏≠‡∏ô A ‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î
                const overlap = dateRange.startDate <= endFilterDate && dateRange.endDate >= startFilterDate;
                return overlap;
            });

            // 2. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏¥‡∏™‡∏ï‡πå‡∏Ç‡∏≠‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ù‡∏∂‡∏Å‡∏Ø (‡πÉ‡∏ä‡πâ name ‡∏´‡∏£‡∏∑‡∏≠ province ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö match ‡∏Å‡∏±‡∏ö data1)
            const matchingCenterNames = filteredCentersDetails.map(detail => detail.province || detail.name);

            // 3. ‡∏Å‡∏£‡∏≠‡∏á data1 ‡∏ï‡∏≤‡∏°‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ù‡∏∂‡∏Å‡∏Ø ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
            filteredData1 = data1.filter(stat => {
                const centerKey = stat.center;
                
                if (centerKey === "‡∏ö‡πâ‡∏≤‡∏ô‡∏ä‡∏≤‡∏¢‡∏Å‡∏£‡∏∏‡∏ì‡∏≤") {
                    // ‡∏ö‡πâ‡∏≤‡∏ô‡∏ä‡∏≤‡∏¢‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏ô data1 ‡∏ñ‡∏π‡∏Å map ‡∏Å‡∏±‡∏ö '‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏õ‡∏£‡∏≤‡∏Å‡∏≤‡∏£' ‡πÉ‡∏ô data2
                    return matchingCenterNames.includes("‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏õ‡∏£‡∏≤‡∏Å‡∏≤‡∏£") || matchingCenterNames.some(name => name.includes("‡∏ö‡πâ‡∏≤‡∏ô‡∏ä‡∏≤‡∏¢‡∏Å‡∏£‡∏∏‡∏ì‡∏≤"));
                }
                return matchingCenterNames.includes(centerKey);
            });

            // 4. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡∏ß‡∏°
            globalTotalStats = calculateTotalStats(filteredData1);
            
            // 5. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI
            updateUI();
        }

        /**
         * üîë ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á
         */
        function resetFilter() {
            filteredData1 = data1;
            globalTotalStats = calculateTotalStats(data1);
            
            // ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô Flatpickr UI
            const fp = document.getElementById('dateRangePicker')._flatpickr;
            if (fp) {
                fp.clear();
            }
            updateUI();
        }

        // ------------------------------------------------------------
        // ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ filteredData1 ‡πÅ‡∏•‡∏∞ globalTotalStats

        function toggleLanguage() {
            currentLang = currentLang === 'th' ? 'en' : 'th';
            updateUI();
        }

        function updateUI() {
            const t = i18n[currentLang];

            // 1. Update Static Text
            document.getElementById('navTitle').innerText = t.navTitle;
            document.getElementById('navSubtitle').innerText = t.navSubtitle;
            document.getElementById('langText').innerText = t.langText;
            document.getElementById('langIcon').innerText = currentLang === 'th' ? 'TH' : 'EN';
            document.getElementById('btnPrint').innerText = t.btnPrint;
            document.getElementById('card1Title').innerText = t.card1Title;
            document.getElementById('unitPerson').innerText = t.unitPerson;
            document.getElementById('card2Title').innerText = t.card2Title;
            document.getElementById('unitPerson2').innerText = t.unitPerson2;
            document.getElementById('card3Title').innerText = t.card3Title;
            document.getElementById('unitCenter').innerText = t.unitCenter;
            document.getElementById('chart1Title').innerText = t.chart1Title;
            document.getElementById('chart2Title').innerText = t.chart2Title;
            document.getElementById('tableTitle').innerText = t.tableTitle;
            document.getElementById('tableSubtitle').innerText = t.tableSubtitle;
            document.getElementById('thCenter').innerText = t.thCenter;
            document.getElementById('thDate').innerText = t.thDate;
            document.getElementById('thMale').innerText = t.thMale;
            document.getElementById('thFemale').innerText = t.thFemale;
            document.getElementById('thTotal').innerText = t.thTotal;
            document.getElementById('footerTotal').innerText = t.footerTotal;

            // 2. Update Stats (‡πÉ‡∏ä‡πâ globalTotalStats ‡πÅ‡∏•‡∏∞ filteredData1)
            document.getElementById('totalSamples').innerText = globalTotalStats.sample;
            document.getElementById('maleCount').innerText = globalTotalStats.male;
            document.getElementById('centerCount').innerText = filteredData1.length;
            document.getElementById('totalMaleTable').innerText = globalTotalStats.male;
            document.getElementById('totalFemaleTable').innerText = globalTotalStats.female;
            document.getElementById('totalSampleTable').innerText = globalTotalStats.sample;

            // 3. Render Table
            renderTable(t);

            // 4. Update Charts
            renderCharts(t);
        }

        function renderTable(t) {
            const tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = ''; // Clear existing

            // ‡πÉ‡∏ä‡πâ‡∏≠‡∏≤‡πÄ‡∏£‡∏¢‡πå‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏Å‡∏£‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß: filteredData1
            filteredData1.forEach((row, index) => {
                // Find matching info from data2 based on 'center' property
                let info = data2.find(d => d.province === row.center);
                // Handle the case where the province name in data1 is a center name (like ‡∏ö‡πâ‡∏≤‡∏ô‡∏ä‡∏≤‡∏¢‡∏Å‡∏£‡∏∏‡∏ì‡∏≤)
                if (!info && row.center === "‡∏ö‡πâ‡∏≤‡∏ô‡∏ä‡∏≤‡∏¢‡∏Å‡∏£‡∏∏‡∏ì‡∏≤") {
                    info = data2.find(d => d.name.includes("‡∏ö‡πâ‡∏≤‡∏ô‡∏ä‡∏≤‡∏¢‡∏Å‡∏£‡∏∏‡∏ì‡∏≤"));
                }

                // Determine display values based on language
                const displayName = currentLang === 'th' ? (info ? info.name : row.center) : (info ? info.nameEn : centerTranslations[row.center] || row.center);
                const displayProvince = currentLang === 'th' ? (info ? info.province : '') : (info ? info.provinceEn : '');
                const displayDate = currentLang === 'th' ? (info ? info.date : '-') : (info ? info.dateEn : '-');

                const tr = document.createElement('tr');
                tr.className = "hover:bg-indigo-50/40 transition-colors group cursor-default";
                tr.innerHTML = `
                    <td class="px-6 py-4 text-slate-400 font-mono text-xs">${String(index + 1).padStart(2, '0')}</td>
                    <td class="px-6 py-4">
                        <div class="font-bold text-slate-700 group-hover:text-indigo-700 transition-colors">${displayName}</div>
                        <div class="flex items-center gap-1 text-xs text-slate-400 mt-0.5">
                            <i data-lucide="map-pin" size="10"></i> ${displayProvince}
                        </div>
                    </td>
                    <td class="px-6 py-4">
                        <span class="inline-flex items-center px-3 py-1 rounded-md text-xs font-medium bg-white border border-slate-200 text-slate-600 shadow-sm group-hover:border-indigo-200 group-hover:text-indigo-600 transition-all">
                            <i data-lucide="calendar" size="12" class="mr-1.5 opacity-70"></i>
                            ${displayDate}
                        </span>
                    </td>
                    <td class="px-6 py-4 text-center">
                        <span class="inline-block w-8 py-1 rounded bg-indigo-50 text-indigo-700 font-bold text-xs">${row.male}</span>
                    </td>
                    <td class="px-6 py-4 text-center">
                        <span class="inline-block w-8 py-1 rounded bg-pink-50 text-pink-700 font-bold text-xs">${row.female}</span>
                    </td>
                    <td class="px-6 py-4 text-right">
                        <span class="font-bold text-slate-800 text-base">${row.sample}</span>
                    </td>
                `;
                tableBody.appendChild(tr);
            });
            lucide.createIcons();
        }

        function renderCharts(t) {
            // ‡πÉ‡∏ä‡πâ globalTotalStats ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Doughnut Chart
            const totalStats = globalTotalStats; 

            // --- 1. Gender Distribution (Doughnut Chart) ---
            if (genderChartInstance) {
                genderChartInstance.destroy();
            }

            const genderData = {
                labels: [t.male, t.female],
                datasets: [{
                    data: [totalStats.male, totalStats.female],
                    backgroundColor: [
                        '#4F46E5', // primary (Indigo-600) for Male
                        '#EC4899', // pink-600 for Female
                    ],
                    hoverBackgroundColor: [
                        '#6366F1',
                        '#F472B6',
                    ],
                    borderWidth: 0,
                    spacing: 5,
                }]
            };

            const genderConfig = {
                type: 'doughnut',
                data: genderData,
                options: {
                     responsive: true,
                     maintainAspectRatio: false,
                     cutout: '60%', 
                     plugins: {
                         legend: {
                             position: 'bottom',
                             labels: { padding: 20, usePointStyle: true, font: { family: 'Sarabun, sans-serif' } }
                         },
                         tooltip: {
                             callbacks: {
                                 label: function(context) {
                                     let label = context.label || '';
                                     if (label) { label += ': '; }
                                     if (context.parsed !== null) {
                                         const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                         const percentage = total === 0 ? '0.0%' : ((context.parsed / total) * 100).toFixed(1) + '%';
                                         label += context.parsed + ` (${percentage})`;
                                     }
                                     return label;
                                 }
                             },
                             bodyFont: { family: 'Sarabun, sans-serif' },
                             titleFont: { family: 'Sarabun, sans-serif' }
                         }
                     },
                     layout: { padding: { top: 0, bottom: 10 } }
                }
            };
            
            const genderCtx = document.getElementById('genderChart').getContext('2d');
            genderChartInstance = new Chart(genderCtx, genderConfig);


            // --- 2. Proportion by Center (Bar Chart) ---
            if (pieChartInstance) { 
                pieChartInstance.destroy();
            }

            // Prepare Bar Chart Data (‡πÉ‡∏ä‡πâ filteredData1)
            const centerLabels = filteredData1.map(d => currentLang === 'th' ? d.center : centerTranslations[d.center] || d.center);
            const centerSamples = filteredData1.map(d => d.sample);
            const centerMales = filteredData1.map(d => d.male);
            const centerFemales = filteredData1.map(d => d.female);
            
            const centerChartData = {
                labels: centerLabels,
                datasets: [
                    {
                        label: t.male,
                        data: centerMales,
                        backgroundColor: '#4F46E5', // Indigo-600
                        borderRadius: 4,
                    },
                    {
                        label: t.female,
                        data: centerFemales,
                        backgroundColor: '#EC4899', // Pink-600
                        borderRadius: 4,
                    }
                ]
            };

            const centerChartConfig = {
                type: 'bar',
                data: centerChartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            stacked: true,
                            grid: { display: false },
                            ticks: { font: { family: 'Sarabun, sans-serif' } }
                        },
                        y: {
                            stacked: true,
                            beginAtZero: true,
                            title: { display: true, text: t.thTotal, font: { family: 'Sarabun, sans-serif', weight: 'bold' } },
                            ticks: { font: { family: 'Sarabun, sans-serif' } }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: { usePointStyle: true, padding: 20, font: { family: 'Sarabun, sans-serif' } }
                        },
                        tooltip: {
                            bodyFont: { family: 'Sarabun, sans-serif' },
                            titleFont: { family: 'Sarabun, sans-serif' }
                        }
                    }
                }
            };

            const pieCtx = document.getElementById('centerPieChart').getContext('2d');
            pieChartInstance = new Chart(pieCtx, centerChartConfig);
        }

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
            globalTotalStats = calculateTotalStats(data1); 

            lucide.createIcons();
            setupFlatpickr(); // ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Flatpickr
            updateUI();
        });
    </script>
</body>
</html>
