<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á</title>

  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://unpkg.com/lucide@latest"></script>

  <!-- Flatpickr (Booking Calendar) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/th.js"></script>

  <script>
    tailwind.config = {
      theme: {
        fontFamily: { sans: ['Sarabun', 'sans-serif'] },
        extend: {
          colors: { primary: '#4F46E5', secondary: '#10B981', accent: '#F59E0B' },
          boxShadow: {
            soft: '0 4px 20px -2px rgba(0, 0, 0, 0.05)',
            card: '0 0 0 1px rgba(0,0,0,0.03), 0 2px 8px rgba(0,0,0,0.04)',
          }
        }
      }
    }
  </script>

  <style>
    .animate-fade-in-up { animation: fadeInUp 0.6s ease-out forwards; opacity: 0; transform: translateY(20px); }
    @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }
    .delay-100 { animation-delay: 0.1s; }
    .delay-200 { animation-delay: 0.2s; }
    .delay-300 { animation-delay: 0.3s; }

    .chart-container { position: relative; height: 300px; width: 100%; }

    /* Flatpickr styling */
    .flatpickr-calendar {
      font-family: 'Sarabun', sans-serif !important;
      box-shadow: 0 4px 20px rgba(0,0,0,0.12);
      border-radius: 0.75rem;
      z-index: 1000;
    }
    .flatpickr-day.selected, .flatpickr-day.startRange, .flatpickr-day.endRange,
    .flatpickr-day.selected.inRange, .flatpickr-day.startRange.inRange, .flatpickr-day.endRange.inRange {
      background: #4F46E5 !important;
      border-color: #4F46E5 !important;
      color: white !important;
    }
  </style>
</head>

<body class="bg-gray-50 min-h-screen font-sans text-slate-600">

  <nav class="bg-white border-b border-gray-100">
    <div class="container mx-auto max-w-7xl px-6 py-4 flex justify-between items-center">
      <div class="flex items-center gap-3">
        <div class="p-2 bg-indigo-50 rounded-lg text-indigo-600">
          <i data-lucide="layout-dashboard"></i>
        </div>
        <div>
          <h1 id="navTitle" class="text-xl font-bold text-slate-800 leading-tight">Dashboard ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á</h1>
          <p id="navSubtitle" class="text-xs text-slate-500">‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏à‡∏±‡∏¢‡πÅ‡∏•‡∏∞‡∏•‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà</p>
        </div>
      </div>

      <div class="flex gap-3 items-center">
        <div id="admin-controls-nav"></div>

        <button onclick="toggleLanguage()"
          class="flex items-center gap-2 text-sm font-semibold text-slate-600 hover:text-indigo-600 bg-white border border-slate-200 hover:border-indigo-200 px-3 py-2 rounded-lg transition-all">
          <span class="flex items-center justify-center w-5 h-5 rounded-full bg-slate-100 text-[10px]" id="langIcon">TH</span>
          <span id="langText">English</span>
        </button>

        <button onclick="window.print()"
          class="hidden md:flex items-center gap-2 text-sm font-medium text-slate-500 hover:text-indigo-600 transition-colors bg-gray-50 hover:bg-indigo-50 px-4 py-2 rounded-lg border border-transparent hover:border-indigo-100 cursor-pointer">
          <i data-lucide="printer" size="16"></i>
          <span id="btnPrint">‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</span>
        </button>
      </div>
    </div>
  </nav>

  <main class="container mx-auto max-w-7xl px-6 py-8 space-y-8">

    <!-- Summary Cards -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 animate-fade-in-up">
      <div class="bg-white p-6 rounded-2xl shadow-card hover:shadow-lg transition-shadow duration-300 relative overflow-hidden group">
        <div class="absolute right-0 top-0 h-full w-1/3 bg-gradient-to-l from-blue-50 to-transparent opacity-50 group-hover:from-blue-100 transition-all"></div>
        <div class="relative z-10">
          <div class="flex items-center gap-3 mb-4">
            <div class="p-2.5 rounded-xl bg-blue-100 text-blue-600 shadow-sm">
              <i data-lucide="users" size="20"></i>
            </div>
            <h3 id="card1Title" class="text-sm font-semibold text-slate-500 uppercase tracking-wide">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
          </div>
          <div class="flex items-baseline gap-2">
            <span id="totalSamples" class="text-4xl font-bold text-slate-800 tracking-tight">0</span>
            <span id="unitPerson" class="text-sm font-medium text-slate-400">‡∏Ñ‡∏ô</span>
          </div>
        </div>
      </div>

      <div class="bg-white p-6 rounded-2xl shadow-card hover:shadow-lg transition-shadow duration-300 relative overflow-hidden group">
        <div class="absolute right-0 top-0 h-full w-1/3 bg-gradient-to-l from-indigo-50 to-transparent opacity-50 group-hover:from-indigo-100 transition-all"></div>
        <div class="relative z-10">
          <div class="flex items-center gap-3 mb-4">
            <div class="p-2.5 rounded-xl bg-indigo-100 text-indigo-600 shadow-sm">
              <i data-lucide="user" size="20"></i>
            </div>
            <h3 id="card2Title" class="text-sm font-semibold text-slate-500 uppercase tracking-wide">‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏û‡∏®‡∏ä‡∏≤‡∏¢</h3>
          </div>
          <div class="flex items-baseline gap-2">
            <span id="maleCount" class="text-4xl font-bold text-slate-800 tracking-tight">0</span>
            <span id="unitPerson2" class="text-sm font-medium text-slate-400">‡∏Ñ‡∏ô</span>
          </div>
        </div>
      </div>

      <div class="bg-white p-6 rounded-2xl shadow-card hover:shadow-lg transition-shadow duration-300 relative overflow-hidden group">
        <div class="absolute right-0 top-0 h-full w-1/3 bg-gradient-to-l from-emerald-50 to-transparent opacity-50 group-hover:from-emerald-100 transition-all"></div>
        <div class="relative z-10">
          <div class="flex items-center gap-3 mb-4">
            <div class="p-2.5 rounded-xl bg-emerald-100 text-emerald-600 shadow-sm">
              <i data-lucide="map-pin" size="20"></i>
            </div>
            <h3 id="card3Title" class="text-sm font-semibold text-slate-500 uppercase tracking-wide">‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ù‡∏∂‡∏Å‡∏Ø ‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</h3>
          </div>
          <div class="flex items-baseline gap-2">
            <span id="centerCount" class="text-4xl font-bold text-slate-800 tracking-tight">0</span>
            <span id="unitCenter" class="text-sm font-medium text-slate-400">‡πÅ‡∏´‡πà‡∏á</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Charts -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <div class="bg-white p-6 rounded-2xl shadow-soft border border-gray-100 animate-fade-in-up delay-100">
        <div class="mb-6">
          <h2 id="chart1Title" class="text-xl font-bold text-slate-800 flex items-center gap-2">
            <i data-lucide="pie-chart" class="text-indigo-500"></i>
            ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏ï‡∏±‡∏ß‡∏Ç‡∏≠‡∏á‡πÄ‡∏û‡∏®
          </h2>
          <p id="chart1Subtitle" class="text-sm text-slate-500 mt-1">‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏û‡∏®‡∏ä‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏®‡∏´‡∏ç‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
        </div>
        <div class="chart-container flex justify-center items-center">
          <canvas id="genderChart"></canvas>
        </div>
      </div>

      <div class="bg-white p-6 rounded-2xl shadow-soft border border-gray-100 animate-fade-in-up delay-200">
        <div class="mb-6">
          <h2 id="chart2Title" class="text-xl font-bold text-slate-800 flex items-center gap-2">
            <i data-lucide="bar-chart-2" class="text-indigo-500"></i>
            ‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏≤‡∏°‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ù‡∏∂‡∏Å‡∏Ø
          </h2>
          <p id="chart2Subtitle" class="text-sm text-slate-500 mt-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ù‡∏∂‡∏Å‡∏Ø</p>
        </div>
        <div class="chart-container">
          <canvas id="centerBarChart"></canvas>
        </div>
      </div>
    </div>

    <!-- Table -->
    <div class="bg-white rounded-2xl shadow-soft border border-gray-100 overflow-hidden animate-fade-in-up delay-300">
      <div class="p-6 border-b border-gray-100 flex items-center justify-between gap-4">
        <div>
          <h2 class="text-xl font-bold text-slate-800 flex items-center gap-2">
            <i data-lucide="calendar-days" class="text-indigo-500"></i>
            <span id="tableTitle">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà</span>
          </h2>
          <p id="tableSubtitle" class="text-sm text-slate-500 mt-1">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</p>
        </div>
        <span class="px-3 py-1 bg-indigo-50 text-indigo-700 rounded-lg text-xs font-semibold uppercase tracking-wider hidden md:block">Year 2025-2026</span>
      </div>

      <div class="overflow-x-auto">
        <table class="w-full text-sm text-left">
          <thead class="bg-gray-50 text-slate-500 font-semibold text-xs uppercase tracking-wider">
            <tr>
              <th class="px-6 py-4 rounded-tl-lg">#</th>
              <th id="thCenter" class="px-6 py-4">‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ù‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏≠‡∏ö‡∏£‡∏°‡∏Ø</th>

              <!-- ‚úÖ ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏° (‡∏´‡∏•‡∏±‡∏á‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ù‡∏∂‡∏Å) -->
              <th id="thBooking" class="px-6 py-4">Booking</th>

              <th id="thMale" class="px-6 py-4 text-center">‡∏ä‡∏≤‡∏¢</th>
              <th id="thFemale" class="px-6 py-4 text-center">‡∏´‡∏ç‡∏¥‡∏á</th>
              <th id="thTotal" class="px-6 py-4 text-right rounded-tr-lg">‡∏£‡∏ß‡∏° (‡∏Ñ‡∏ô)</th>
            </tr>
          </thead>
          <tbody id="tableBody" class="divide-y divide-gray-100"></tbody>
          <tfoot class="bg-gray-50/50 font-bold text-slate-800">
            <tr>
              <td id="footerTotal" colspan="3" class="px-6 py-5 text-right text-slate-500">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</td>
              <td id="totalMaleTable" class="px-6 py-5 text-center text-indigo-600">0</td>
              <td id="totalFemaleTable" class="px-6 py-5 text-center text-pink-600">0</td>
              <td id="totalSampleTable" class="px-6 py-5 text-right text-lg">0</td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>

  </main>

  <script>
    // ===== Admin =====
    const ADMIN_PASSWORD = "admin456";
    const STORAGE_KEY = "dashboardBookingRanges_v1";

    let currentLang = "th";
    let isLoggedIn = false;
    let isAdminMode = false;

    // ===== i18n =====
    const i18n = {
      th: {
        navTitle: "Dashboard ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á",
        navSubtitle: "‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏à‡∏±‡∏¢‡πÅ‡∏•‡∏∞‡∏•‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà",
        langText: "English",
        btnPrint: "‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô",

        card1Title: "‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î",
        card2Title: "‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏û‡∏®‡∏ä‡∏≤‡∏¢",
        card3Title: "‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ù‡∏∂‡∏Å‡∏Ø ‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°",
        unitPerson: "‡∏Ñ‡∏ô",
        unitPerson2: "‡∏Ñ‡∏ô",
        unitCenter: "‡πÅ‡∏´‡πà‡∏á",

        chart1Title: "‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏ï‡∏±‡∏ß‡∏Ç‡∏≠‡∏á‡πÄ‡∏û‡∏®",
        chart1Subtitle: "‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏û‡∏®‡∏ä‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏®‡∏´‡∏ç‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î",
        chart2Title: "‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏≤‡∏°‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ù‡∏∂‡∏Å‡∏Ø",
        chart2Subtitle: "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ù‡∏∂‡∏Å‡∏Ø",

        tableTitle: "‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà",
        tableSubtitle: "‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£",
        thCenter: "‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ù‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏≠‡∏ö‡∏£‡∏°‡∏Ø",
        thBooking: "Booking",
        thMale: "‡∏ä‡∏≤‡∏¢",
        thFemale: "‡∏´‡∏ç‡∏¥‡∏á",
        thTotal: "‡∏£‡∏ß‡∏° (‡∏Ñ‡∏ô)",
        footerTotal: "‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î",

        male: "‡∏ä‡∏≤‡∏¢",
        female: "‡∏´‡∏ç‡∏¥‡∏á",

        bookingPick: "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô",
        bookingEmpty: "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î",
        bookingReadonly: "‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£",

        adminLogin: "üîí Admin Login",
        adminEdit: "‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Booking",
        adminSave: "üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å",
        adminCancel: "‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å",
        adminLogout: "‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö",
        adminBadge: "‚úÖ Admin",

        confirmSave: "‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á Booking ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?",
        confirmCancel: "‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å) ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?",
        confirmLogout: "‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö Admin ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?",
        promptPass: "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö:",
        loginOk: "‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß",
        passWrong: "‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á",
        saved: "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!"
      },
      en: {
        navTitle: "Sampling Dashboard",
        navSubtitle: "Research Status & Field Visit Tracking",
        langText: "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢",
        btnPrint: "Print Report",

        card1Title: "Total Samples",
        card2Title: "Male Count",
        card3Title: "Participating Centers",
        unitPerson: "Persons",
        unitPerson2: "Persons",
        unitCenter: "Centers",

        chart1Title: "Gender Distribution",
        chart1Subtitle: "Male and female ratio from all samples",
        chart2Title: "Proportion by Center",
        chart2Subtitle: "Total samples in each training center",

        tableTitle: "Field Visit Schedule",
        tableSubtitle: "Sample size details and operation periods",
        thCenter: "Training Center",
        thBooking: "Booking",
        thMale: "Male",
        thFemale: "Female",
        thTotal: "Total",
        footerTotal: "Grand Total",

        male: "Male",
        female: "Female",

        bookingPick: "Pick dates",
        bookingEmpty: "Not set",
        bookingReadonly: "Operation period",

        adminLogin: "üîí Admin Login",
        adminEdit: "‚úèÔ∏è Edit Booking",
        adminSave: "üíæ Save",
        adminCancel: "Cancel",
        adminLogout: "Logout",
        adminBadge: "‚úÖ Admin",

        confirmSave: "Save booking changes?",
        confirmCancel: "Cancel all edits (not saved)?",
        confirmLogout: "Logout Admin?",
        promptPass: "Enter admin password:",
        loginOk: "Login successful! Edit mode enabled.",
        passWrong: "Wrong password",
        saved: "Saved!"
      }
    };

    const centerTranslations = {
      "‡∏£‡∏∞‡∏¢‡∏≠‡∏á": "Rayong",
      "‡∏£‡∏≤‡∏ä‡∏ö‡∏∏‡∏£‡∏µ": "Ratchaburi",
      "‡∏ö‡πâ‡∏≤‡∏ô‡∏ä‡∏≤‡∏¢‡∏Å‡∏£‡∏∏‡∏ì‡∏≤": "Ban Chai Karuna",
      "‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà": "Chiang Mai",
      "‡∏™‡∏∏‡∏£‡∏≤‡∏©‡∏é‡∏£‡πå‡∏ò‡∏≤‡∏ô‡∏µ": "Surat Thani",
      "‡∏≠‡∏∏‡∏ö‡∏•‡∏£‡∏≤‡∏ä‡∏ò‡∏≤‡∏ô‡∏µ": "Ubon Ratchathani"
    };

    // ===== Data =====
    const data1 = [
      { center: "‡∏£‡∏∞‡∏¢‡∏≠‡∏á", sample: 18, male: 14, female: 4 },
      { center: "‡∏ö‡πâ‡∏≤‡∏ô‡∏ä‡∏≤‡∏¢‡∏Å‡∏£‡∏∏‡∏ì‡∏≤", sample: 47, male: 47, female: 0 },
      { center: "‡∏£‡∏≤‡∏ä‡∏ö‡∏∏‡∏£‡∏µ", sample: 41, male: 40, female: 1 },
      { center: "‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà", sample: 60, male: 56, female: 4 },
      { center: "‡∏™‡∏∏‡∏£‡∏≤‡∏©‡∏é‡∏£‡πå‡∏ò‡∏≤‡∏ô‡∏µ", sample: 66, male: 60, female: 6 },
      { center: "‡∏≠‡∏∏‡∏ö‡∏•‡∏£‡∏≤‡∏ä‡∏ò‡∏≤‡∏ô‡∏µ", sample: 140, male: 131, female: 9 }
    ];

    // bookingRangesByCenter = { "‡∏£‡∏∞‡∏¢‡∏≠‡∏á": {start:"2025-11-17", end:"2025-11-22"}, ... }
    let bookingRangesByCenter = {};
    let tempBookingRangesByCenter = {};

    // ===== Charts =====
    let genderChartInstance = null;
    let centerChartInstance = null;

    // ===== Utils =====
    function calculateTotalStats(data) {
      return data.reduce((acc, curr) => ({
        sample: acc.sample + curr.sample,
        male: acc.male + curr.male,
        female: acc.female + curr.female
      }), { sample: 0, male: 0, female: 0 });
    }

    function pad2(n) { return String(n).padStart(2, '0'); }

    function toISODate(d) {
      return `${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}`;
    }

    function formatRangeThai(startISO, endISO) {
      if (!startISO || !endISO) return "";
      const thMonth = ['‡∏°.‡∏Ñ.','‡∏Å.‡∏û.','‡∏°‡∏µ.‡∏Ñ.','‡πÄ‡∏°.‡∏¢.','‡∏û.‡∏Ñ.','‡∏°‡∏¥.‡∏¢.','‡∏Å.‡∏Ñ.','‡∏™.‡∏Ñ.','‡∏Å.‡∏¢.','‡∏ï.‡∏Ñ.','‡∏û.‡∏¢.','‡∏ò.‡∏Ñ.'];
      const s = new Date(startISO + "T00:00:00");
      const e = new Date(endISO + "T00:00:00");
      const yy = (s.getFullYear() + 543) % 100;
      const yy2 = String(yy).padStart(2,'0');

      if (s.toDateString() === e.toDateString()) {
        return `${s.getDate()} ${thMonth[s.getMonth()]} ${yy2}`;
      }
      if (s.getMonth() === e.getMonth() && s.getFullYear() === e.getFullYear()) {
        return `${s.getDate()} ‚Äì ${e.getDate()} ${thMonth[s.getMonth()]} ${yy2}`;
      }
      // ‡∏Ç‡πâ‡∏≤‡∏°‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
      return `${s.getDate()} ${thMonth[s.getMonth()]} ‚Äì ${e.getDate()} ${thMonth[e.getMonth()]} ${yy2}`;
    }

    function formatRangeEn(startISO, endISO) {
      if (!startISO || !endISO) return "";
      const enMonth = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
      const s = new Date(startISO + "T00:00:00");
      const e = new Date(endISO + "T00:00:00");
      const yy = String(s.getFullYear() % 100).padStart(2,'0');

      if (s.toDateString() === e.toDateString()) {
        return `${s.getDate()} ${enMonth[s.getMonth()]} ${yy}`;
      }
      if (s.getMonth() === e.getMonth() && s.getFullYear() === e.getFullYear()) {
        return `${s.getDate()} ‚Äì ${e.getDate()} ${enMonth[s.getMonth()]} ${yy}`;
      }
      return `${s.getDate()} ${enMonth[s.getMonth()]} ‚Äì ${e.getDate()} ${enMonth[e.getMonth()]} ${yy}`;
    }

    function displayRangeForLang(range) {
      if (!range?.start || !range?.end) return "";
      return currentLang === "th"
        ? formatRangeThai(range.start, range.end)
        : formatRangeEn(range.start, range.end);
    }

    // ===== Storage =====
    function loadBooking() {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (raw) {
        bookingRangesByCenter = JSON.parse(raw);
      } else {
        // ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (‡πÉ‡∏™‡πà‡πÑ‡∏î‡πâ/‡πÅ‡∏Å‡πâ‡πÑ‡∏î‡πâ‡πÉ‡∏ô Admin)
        bookingRangesByCenter = {
          "‡∏£‡∏∞‡∏¢‡∏≠‡∏á": { start: "2025-11-17", end: "2025-11-22" },
          "‡∏ö‡πâ‡∏≤‡∏ô‡∏ä‡∏≤‡∏¢‡∏Å‡∏£‡∏∏‡∏ì‡∏≤": { start: "2025-12-08", end: "2025-12-13" },
          "‡∏£‡∏≤‡∏ä‡∏ö‡∏∏‡∏£‡∏µ": { start: "2025-12-15", end: "2025-12-20" },
          "‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà": { start: "2026-01-05", end: "2026-01-10" },
          "‡∏™‡∏∏‡∏£‡∏≤‡∏©‡∏é‡∏£‡πå‡∏ò‡∏≤‡∏ô‡∏µ": { start: "2026-01-19", end: "2026-01-24" },
          // ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡πÅ‡∏£‡∏Å (‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏´‡∏•‡∏≤‡∏¢‡∏ä‡πà‡∏ß‡∏á ‡∏Ñ‡πà‡∏≠‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏° logic ‡πÑ‡∏î‡πâ)
          "‡∏≠‡∏∏‡∏ö‡∏•‡∏£‡∏≤‡∏ä‡∏ò‡∏≤‡∏ô‡∏µ": { start: "2026-02-02", end: "2026-02-07" }
        };
        localStorage.setItem(STORAGE_KEY, JSON.stringify(bookingRangesByCenter));
      }
      tempBookingRangesByCenter = JSON.parse(JSON.stringify(bookingRangesByCenter));
    }

    function persistBooking() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(bookingRangesByCenter));
    }

    // ===== Admin Controls =====
    function renderAdminControls() {
      const t = i18n[currentLang];
      const el = document.getElementById("admin-controls-nav");
      let html = "";

      if (!isLoggedIn) {
        html = `<button onclick="handleLogin()" class="px-4 py-2 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 transition-colors duration-200 text-sm">
          ${t.adminLogin}
        </button>`;
      } else if (isAdminMode) {
        html = `
          <button onclick="handleSave()" class="px-4 py-2 bg-emerald-600 text-white font-semibold rounded-lg shadow-md hover:bg-emerald-700 transition-colors duration-200 text-sm">
            ${t.adminSave}
          </button>
          <button onclick="handleCancel()" class="px-4 py-2 border border-gray-300 text-gray-700 font-semibold rounded-lg hover:bg-gray-100 transition-colors duration-200 text-sm">
            ${t.adminCancel}
          </button>
          <button onclick="handleLogout()" class="px-4 py-2 bg-red-100 text-red-600 font-semibold rounded-lg hover:bg-red-200 transition-colors duration-200 text-sm">
            ${t.adminLogout}
          </button>
        `;
      } else {
        html = `
          <span class="text-sm font-medium text-gray-500 flex items-center">${t.adminBadge}</span>
          <button onclick="handleLogin()" class="px-4 py-2 bg-yellow-500 text-white font-semibold rounded-lg shadow-md hover:bg-yellow-600 transition-colors duration-200 text-sm">
            ${t.adminEdit}
          </button>
          <button onclick="handleLogout()" class="px-4 py-2 bg-red-100 text-red-600 font-semibold rounded-lg hover:bg-red-200 transition-colors duration-200 text-sm">
            ${t.adminLogout}
          </button>
        `;
      }

      el.innerHTML = html;
    }

    function handleLogin() {
      const t = i18n[currentLang];

      // ‡∏ñ‡πâ‡∏≤‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
      if (isLoggedIn && !isAdminMode) {
        isAdminMode = true;
        tempBookingRangesByCenter = JSON.parse(JSON.stringify(bookingRangesByCenter));
        updateUI();
        return;
      }

      const password = prompt(t.promptPass);
      if (password === ADMIN_PASSWORD) {
        isLoggedIn = true;
        isAdminMode = true;
        tempBookingRangesByCenter = JSON.parse(JSON.stringify(bookingRangesByCenter));
        alert(t.loginOk);
      } else if (password !== null) {
        alert(t.passWrong);
      }
      updateUI();
    }

    function handleCancel() {
      const t = i18n[currentLang];
      if (confirm(t.confirmCancel)) {
        isAdminMode = false;
        tempBookingRangesByCenter = JSON.parse(JSON.stringify(bookingRangesByCenter));
        updateUI();
      }
    }

    function handleSave() {
      const t = i18n[currentLang];
      if (confirm(t.confirmSave)) {
        bookingRangesByCenter = JSON.parse(JSON.stringify(tempBookingRangesByCenter));
        persistBooking();
        isAdminMode = false;
        alert(t.saved);
        updateUI();
      }
    }

    function handleLogout() {
      const t = i18n[currentLang];
      if (confirm(t.confirmLogout)) {
        isLoggedIn = false;
        isAdminMode = false;
        tempBookingRangesByCenter = JSON.parse(JSON.stringify(bookingRangesByCenter));
        updateUI();
      }
    }

    // ===== Booking Picker (per-row) =====
    function openBookingPicker(centerKey, hiddenInputId) {
      if (!isAdminMode) return;

      const current = tempBookingRangesByCenter[centerKey];
      const input = document.getElementById(hiddenInputId);

      if (input._flatpickr) input._flatpickr.destroy();

      const defaultDates = (current?.start && current?.end)
        ? [current.start, current.end]
        : null;

      const locale = (currentLang === "th") ? "th" : "default";

      const fp = flatpickr(input, {
        mode: "range",
        dateFormat: "Y-m-d",
        locale,
        defaultDate: defaultDates,
        clickOpens: false,
        allowInput: false,
        onClose: (selectedDates) => {
          if (selectedDates.length === 2) {
            const start = toISODate(selectedDates[0]);
            const end = toISODate(selectedDates[1]);
            tempBookingRangesByCenter[centerKey] = { start, end };
            updateUI();
          }
          fp.destroy();
        }
      });

      fp.open();
    }

    // ===== Render =====
    function toggleLanguage() {
      currentLang = (currentLang === "th") ? "en" : "th";
      updateUI();
    }

    function renderTable(t) {
      const tbody = document.getElementById("tableBody");
      tbody.innerHTML = "";

      data1.forEach((row, idx) => {
        const tr = document.createElement("tr");
        tr.className = "hover:bg-indigo-50/40 transition-colors group";

        const centerName = (currentLang === "th")
          ? row.center
          : (centerTranslations[row.center] || row.center);

        const rangeSource = isAdminMode ? tempBookingRangesByCenter : bookingRangesByCenter;
        const range = rangeSource[row.center];
        const rangeText = displayRangeForLang(range);
        const emptyText = t.bookingEmpty;

        const hiddenId = `booking-input-${row.center}-${idx}`.replace(/\s+/g, "-");

        // ‚úÖ Booking column logic:
        // - Admin mode: show clickable badge (opens flatpickr)
        // - Normal mode: show readonly badge (operation period)
        const bookingCellHTML = isAdminMode
          ? `
            <div class="flex items-center gap-2">
              <button
                class="inline-flex items-center px-3 py-1 rounded-md text-xs font-semibold bg-indigo-100 border border-indigo-300 text-indigo-700 shadow-sm hover:bg-indigo-200 transition-all"
                onclick="openBookingPicker('${row.center}', '${hiddenId}')"
                type="button"
                title="Booking"
              >
                <i data-lucide="calendar" size="12" class="mr-1.5 opacity-80"></i>
                ${rangeText ? rangeText : t.bookingPick}
              </button>
              <input id="${hiddenId}" type="text" class="hidden" />
              ${rangeText ? "" : `<span class="text-xs text-slate-400">${emptyText}</span>`}
            </div>
          `
          : `
            <span class="inline-flex items-center px-3 py-1 rounded-md text-xs font-medium bg-white border border-slate-200 text-slate-600 shadow-sm">
              <i data-lucide="calendar" size="12" class="mr-1.5 opacity-70"></i>
              ${rangeText ? rangeText : "-"}
            </span>
          `;

        tr.innerHTML = `
          <td class="px-6 py-4 text-slate-400 font-mono text-xs">${String(idx + 1).padStart(2, "0")}</td>

          <td class="px-6 py-4">
            <div class="font-bold text-slate-700 group-hover:text-indigo-700 transition-colors">
              ${centerName}
            </div>
          </td>

          <!-- ‚úÖ ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå Booking (‡∏´‡∏•‡∏±‡∏á‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ù‡∏∂‡∏Å) -->
          <td class="px-6 py-4">
            ${bookingCellHTML}
          </td>

          <td class="px-6 py-4 text-center">
            <span class="inline-block w-8 py-1 rounded bg-indigo-50 text-indigo-700 font-bold text-xs">${row.male}</span>
          </td>
          <td class="px-6 py-4 text-center">
            <span class="inline-block w-8 py-1 rounded bg-pink-50 text-pink-700 font-bold text-xs">${row.female}</span>
          </td>
          <td class="px-6 py-4 text-right">
            <span class="font-bold text-slate-800 text-base">${row.sample}</span>
          </td>
        `;

        tbody.appendChild(tr);
      });

      lucide.createIcons();
    }

    function renderCharts(t, totalStats) {
      // 1) Gender chart
      if (genderChartInstance) genderChartInstance.destroy();
      const genderCtx = document.getElementById('genderChart').getContext('2d');
      genderChartInstance = new Chart(genderCtx, {
        type: 'doughnut',
        data: {
          labels: [t.male, t.female],
          datasets: [{
            data: [totalStats.male, totalStats.female],
            backgroundColor: ['#4F46E5', '#EC4899'],
            borderWidth: 0,
            spacing: 5
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          cutout: '60%',
          plugins: {
            legend: {
              position: 'bottom',
              labels: { padding: 20, usePointStyle: true, font: { family: 'Sarabun, sans-serif' } }
            }
          }
        }
      });

      // 2) Center stacked bar
      if (centerChartInstance) centerChartInstance.destroy();

      const labels = data1.map(d => currentLang === 'th' ? d.center : (centerTranslations[d.center] || d.center));
      const centerMales = data1.map(d => d.male);
      const centerFemales = data1.map(d => d.female);

      const centerCtx = document.getElementById('centerBarChart').getContext('2d');
      centerChartInstance = new Chart(centerCtx, {
        type: 'bar',
        data: {
          labels,
          datasets: [
            { label: t.male, data: centerMales, backgroundColor: '#4F46E5', borderRadius: 4 },
            { label: t.female, data: centerFemales, backgroundColor: '#EC4899', borderRadius: 4 }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            x: { stacked: true, grid: { display: false }, ticks: { font: { family: 'Sarabun, sans-serif' } } },
            y: { stacked: true, beginAtZero: true, ticks: { font: { family: 'Sarabun, sans-serif' } } }
          },
          plugins: {
            legend: { position: 'top', labels: { usePointStyle: true, padding: 20, font: { family: 'Sarabun, sans-serif' } } }
          }
        }
      });
    }

    function updateUI() {
      const t = i18n[currentLang];

      // Text
      document.getElementById('navTitle').innerText = t.navTitle;
      document.getElementById('navSubtitle').innerText = t.navSubtitle;
      document.getElementById('langText').innerText = t.langText;
      document.getElementById('langIcon').innerText = currentLang === 'th' ? 'TH' : 'EN';
      document.getElementById('btnPrint').innerText = t.btnPrint;

      document.getElementById('card1Title').innerText = t.card1Title;
      document.getElementById('card2Title').innerText = t.card2Title;
      document.getElementById('card3Title').innerText = t.card3Title;
      document.getElementById('unitPerson').innerText = t.unitPerson;
      document.getElementById('unitPerson2').innerText = t.unitPerson2;
      document.getElementById('unitCenter').innerText = t.unitCenter;

      document.getElementById('chart1Title').childNodes[2].textContent = " " + t.chart1Title;
      document.getElementById('chart1Subtitle').innerText = t.chart1Subtitle;
      document.getElementById('chart2Title').childNodes[2].textContent = " " + t.chart2Title;
      document.getElementById('chart2Subtitle').innerText = t.chart2Subtitle;

      document.getElementById('tableTitle').innerText = t.tableTitle;
      document.getElementById('tableSubtitle').innerText = t.tableSubtitle;
      document.getElementById('thCenter').innerText = t.thCenter;
      document.getElementById('thBooking').innerText = t.thBooking;
      document.getElementById('thMale').innerText = t.thMale;
      document.getElementById('thFemale').innerText = t.thFemale;
      document.getElementById('thTotal').innerText = t.thTotal;
      document.getElementById('footerTotal').innerText = t.footerTotal;

      // Admin buttons
      renderAdminControls();

      // Stats
      const totalStats = calculateTotalStats(data1);
      document.getElementById('totalSamples').innerText = totalStats.sample;
      document.getElementById('maleCount').innerText = totalStats.male;
      document.getElementById('centerCount').innerText = data1.length;

      document.getElementById('totalMaleTable').innerText = totalStats.male;
      document.getElementById('totalFemaleTable').innerText = totalStats.female;
      document.getElementById('totalSampleTable').innerText = totalStats.sample;

      renderTable(t);
      renderCharts(t, totalStats);
      lucide.createIcons();
    }

    document.addEventListener('DOMContentLoaded', () => {
      loadBooking();
      lucide.createIcons();
      updateUI();
    });
  </script>

</body>
</html>
